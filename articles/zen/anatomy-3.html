<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="metrics.in.r">
<title>Anatomy of an R Project: File Structure • metrics.in.r</title>
<script src="../../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet">
<script src="../../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../../pkgdown.js"></script><meta property="og:title" content="Anatomy of an R Project: File Structure">
<meta property="og:description" content="metrics.in.r">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../../index.html">metrics.in.r</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../../articles/metrics-in-r.html">Get started</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../../articles/index.html">Articles</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/nateybear/metrics-in-r/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Anatomy of an R Project: File Structure</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/nateybear/metrics-in-r/blob/HEAD/vignettes/zen/anatomy-3.Rmd" class="external-link"><code>vignettes/zen/anatomy-3.Rmd</code></a></small>
      <div class="d-none name"><code>anatomy-3.Rmd</code></div>
    </div>

    
    
<div class="section level3">
<h3 id="the-pattern">The Pattern<a class="anchor" aria-label="anchor" href="#the-pattern"></a>
</h3>
<p>File structure can be a non-trivial thing in projects. Badly
structured projects are confusing—you don’t know what comes from where
and can’t tell heads from tails. File names are meaningful, and the
folders you put them in are meaningful. In our code, we can create a
consistent way to refer to them. This is the focus of this article. I
will give a philosophy of file organization, and a specific example that
I have used before. It is from a replication assignment, and you can
find it <a href="https://github.com/nateybear/causal-inference-2022" class="external-link">here</a>. The
example is not intended to be the be-all-end-all of what you should do.
Take it more as a guideline for your work.</p>
</div>
<div class="section level3">
<h3 id="data">Data<a class="anchor" aria-label="anchor" href="#data"></a>
</h3>
<p>If you’re running a research project, you probably are using some
data. If you are using data, you probably will need to clean it somehow.
Keep your data in a folder called “data.” If you need to clean it, write
an R script inside of a folder called “R” and a subfolder that is
reserved for data cleaning/building tasks. In my example below I call
this folder “build.”</p>
<p><img src="https://raw.githubusercontent.com/nateybear/causal-inference-2022/main/writing/rdemo_assets/build-directory.png" title="Showing the correspondence between data names and the R scripts that build them"></p>
<p>The name of the R script corresponds to the name of the data set that
it cleans. It reads in a “raw” data file, applies whatever
transformations are necessary to arrive at a “clean” dataset, and then
writes the clean dataset to a new file. The point is to exactly document
the steps to get from a dataset that you find on the Internet or in the
wild to the dataset that you use in your regressions.</p>
</div>
<div class="section level3">
<h3 id="tables-and-figures">Tables and Figures<a class="anchor" aria-label="anchor" href="#tables-and-figures"></a>
</h3>
<p>If you’re writing a report, you probably have figures and tables that
you need to include. You write R scripts that read in the cleaned data
and generate some output as a <code>.png</code> (for figures) or
<code>.tex</code> (for tables). As with data, your figures and tables
live in clearly marked folders. The R scripts that generate the figures
or tables have names that correspond to the figures or tables that they
create. In my example project, I made a subfolder in the R directory
called “output” that has code to generate both tables and figures:</p>
<p><img src="https://raw.githubusercontent.com/nateybear/causal-inference-2022/main/writing/rdemo_assets/describe-directory.png" title="Correspondence between names of figures and tables and names or R scripts">
When you’re creating a figure, you are reading in a cleaned dataset,
possibly doing some cleaning, and then generating a graph. I strongly
recommend using the <a href="https://ggplot2.tidyverse.org/" class="external-link">ggplot2</a>
package. You can then use the <code><a href="https://ggplot2.tidyverse.org/reference/ggsave.html" class="external-link">ggsave()</a></code> function to write
your graph as a png file.</p>
<p>For tables, you will often have a data frame that represents the
table that you want to put in your paper. The <a href="https://cran.r-project.org/web/packages/kableExtra/vignettes/awesome_table_in_pdf.pdf" class="external-link"><code>kableExtra</code></a>
package has utilities to generate a pretty LaTeX table from a data
frame, and then you can write to a file using the tidyverse function
<code><a href="https://readr.tidyverse.org/reference/read_lines.html" class="external-link">write_lines()</a></code>.</p>
<p>Other times, you may want to output a regression summary into a
table. You can either use the <code><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy()</a></code> function from the
<code>broom</code> package to turn your summary into a data frame, and
then follow the <code>kableExtra</code> steps above; or you can use the
<a href="https://cran.r-project.org/web/packages/stargazer/vignettes/stargazer.pdf" class="external-link"><code>stargazer</code></a>
package to generate pretty regression output. The trade-off between the
two is that because stargazer gives you so much out-of-the-box
functionality, it’s naturally harder to configure it for a very specific
use case.</p>
</div>
<div class="section level3">
<h3 id="where-are-my-files-here-they-are-">Where are my files? <code>here</code> they are.<a class="anchor" aria-label="anchor" href="#where-are-my-files-here-they-are-"></a>
</h3>
<p>We’ve talked a lot about reading and writing files in this article,
so obviously there is a little bit of nuance that I want to impart on
you. There are a few different ways that we can refer to files in our
code.</p>
<p>The first is an <strong>absolute</strong> path to our file. This
tells the computer how to find the file from the very top of the
filesystem. For example, a dataset in an R project called “my-project”
would look like
<code>/Users/nate/workspace/my-project/data/some_dataset.csv</code> on
my computer. You can tell a path is an absolute path because it begins
with a forward slash, <code>/</code>. Absolute paths can also start with
a tilde, <code>~</code>, which indicates that the location is relative
to the home directory of the user. My home directory is at
<code>/Users/nate</code> on my computer, so
<code>~/workspace/my-project/data/some_dataset.csv</code> and
<code>/Users/nate/workspace/my-project/data/some_dataset.csv</code> are
the same thing.</p>
<p>Why are absolute file paths bad? Because they only work on your
computer. If some else runs your code, they will have to change the path
of the file to wherever their project is located on their own computer.
There are better ways to do this. You should avoid absolute paths at all
costs, and you will lose points on your assignments if I see an absolute
path in your code.</p>
<p>The second way to refer to files is via a <strong>relative</strong>
path. This tells the computer how to find the file <em>relative</em> to
some folder that I’m currently in. Usually, this is the folder that
holds the R script that is running. Relative paths can be identified
because they start with <code>./</code> or <code>../</code>. If my code
to clean the <code>some_dataset.csv</code> file above lives in
<code>~/workspace/my-project/R/build/some_dataset.R</code> (that is, it
lives inside the “build” folder inside of the “R” folder in my project),
then I can refer to the dataset file in my R code by writing
<code>../../data/some_dataset.csv</code>. That means, “Go up one folder
(to the ‘R’ folder), go up another folder (to the ‘my-project’ folder),
go into the data folder, and find some_dataset.csv there.” Two dots,
<code>../</code>, refers to your script’s parent folder, and one dot,
<code>./</code>, refers to the folder that it is currently in. In most
cases, the one dot can be implicit: hence, <code>my_script.R</code> and
<code>./my_script.R</code> refer to the same thing.</p>
<p>Why are relative file paths bad? They usually do work on multiple
computers because of their relative nature. However, they are prone to
break when you reorganize your code. Say for example that you started
out with all of your code in one <code>R</code> folder, but then later
decide to move your code to multiple subfolders, like
<code>R/build</code> and <code>R/output</code>. When that happens, the
path to your data file is no longer <code>../data/my_dataset.csv</code>,
it’s now <code>../../data/my_dataset.csv</code>. To be clear this is not
the worst thing in the world, and relative file paths are acceptable in
many software engineering contexts. For our purposes, we can do better,
though.</p>
<p>The ideal way to refer to files in our projects is via a
<strong>project-relative</strong> path. This tells the computer, “Look
for the closest <code>.Rproj</code> file, then look relative to that
folder for my file.” This is ideal because it both runs on multiple
computers and is robust to you reorganizing your R scripts. The way we
do this in R is easy. We load the <code>here</code> library, then use
the <code><a href="https://here.r-lib.org//reference/here.html" class="external-link">here()</a></code> function whenever we refer to a file. So, the
dataset that we have been working with this entire time could be
referred to with <code>here("data/my_dataset.csv")</code>. This may seem
a little abstract, but you can find plenty of usages in my example
project that I linked. One instance is <a href="https://github.com/nateybear/causal-inference-2022/blob/main/R/output/figure_arrests_by_racegender.R" class="external-link">here</a>
in the code for generating a figure.</p>
<p>One thing to keep in mind with <code>here</code>: It is
project-specific. So that means that if you don’t have a project open in
RStudio or you have the wrong project open, then <code>here</code> will
not be able to find your files correctly. If you work with projects the
way that I have suggested you should, this will not be an issue since
you will always have a project open.</p>
</div>
<div class="section level3">
<h3 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h3>
<p>Be militant with file naming. Follow a file structure that is
<em>self-evident</em>. This fits perfectly with the “consistent and
predictable” mantra from my meditation on programming. The
<code>here</code> package gives you a consistent and predictable way to
refer to files inside of your project.</p>
</div>
<div class="section level3">
<h3 id="bonus-build-tools">Bonus: Build Tools<a class="anchor" aria-label="anchor" href="#bonus-build-tools"></a>
</h3>
<p>It is more than enough to make your code so self-evident that someone
else can figure out how to run your scripts and compile your project. To
take it a step further, you can use a build tools such as a Makefile or
a <code>targets</code> file. These are step-by-step recipes of how to
build your projects.</p>
<p>The common vocabulary words that both of these tools use are “target”
and “dependency.” A target is something that you want to produce—think
of your cleaned dataset, your figure, your LaTeX report. A dependency
describes what the target needs to have to run. Build tools track the
dependencies so that targets only need to be rebuilt when a dependency
changes. This means that you may have many scripts that you need to run
that take a long time when all run together, but when using a build
tool, it will only build targets for the small parts of the project that
<em>actually changed</em>.</p>
<p>Make is a file-based build tool, configured using a file
appropriately called the Makefile. Make’s targets and dependencies are
specified as files that exist in your project, and Make determines if a
target needs to be rebuilt by comparing the last modified time of the
target file with the last modified time of all of its dependencies. Make
is a concept that almost all software engineers are familiar with, so
this is my preferred build tool. The one drawback is that it is
file-based, so you inherently have to structure your project so that
every target is a file (as opposed configuring targets inside of your R
code). A good guide to Make for data scientists can be found <a href="https://the-turing-way.netlify.app/reproducible-research/make.html" class="external-link">here</a>.</p>
<p>An alternative to Make is the <code>targets</code> R package. Instead
of being file-based, you write R code to describe your build process.
<code>targets</code> determines whether a target needs to be rebuilt by
comparing hashes (strings of letter which uniquely identify objects in
code) of the dependencies. It is an interesting concept that I
personally haven’t used in a project yet. You can read about the
<code>targets</code> package <a href="https://books.ropensci.org/targets/" class="external-link">here</a>.</p>
<p>Whichever build tool you use, one nice perk is that you can configure
the Build tab in the top right-hand corner of RStudio to work with your
build tool. In the Build tab, you click the “Build All” button and your
project is built! No more having to worry about running scripts in the
right order.</p>
<p>If build tools sound good to you, then cool. It’s beyond the scope of
this article to go more into depth, but it’s an interesting subject. If
you’re my student then feel free to reach out and talk about it.</p>
<hr>
<p>Happy Coding!</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Nathan Gardner Hattersley.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
